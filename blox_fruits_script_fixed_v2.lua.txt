local Show_Button = true
local Button_Icon = "rbxassetid://135671141026630"
local Button_Transparency = 0.1

-- // Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local PathfindingService = game:GetService("PathfindingService")
local Lighting = game:GetService("Lighting")

local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid", 10)
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart", 10)

-- // Anti-Detection Variables
local LastActivity = tick()
local OriginalWalkSpeed = 16
local OriginalJumpPower = 50
local RandomMovements = {}
local DetectionCounters = {
    TeleportCount = 0,
    AttackCount = 0,
    LastTeleport = 0,
    LastAttack = 0
}

-- // Enhanced Character Update
local function UpdateCharacter()
    Character = Player.Character
    if Character then
        Humanoid = Character:FindFirstChildOfClass("Humanoid")
        HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
        if Humanoid then
            OriginalWalkSpeed = Humanoid.WalkSpeed
            OriginalJumpPower = Humanoid.JumpPower
        end
    end
end

Player.CharacterAdded:Connect(function(char)
    Character = char
    wait(2) -- Increased wait time for better stability
    UpdateCharacter()
end)

-- // Script Variables
getgenv().AutoFarmLevel = false
getgenv().AutoFastAttack = false
getgenv().AutoBringMobs = false
getgenv().AutoArmamentHaki = false
getgenv().FruitESP = false
getgenv().BringFruit = false
getgenv().StoreFruit = false
getgenv().SelectedWeapon = "Combat"
getgenv().AutoBossFarm = false
getgenv().SelectedBoss = ""
getgenv().AutoSaber = false
getgenv().Auto2SeaQuest = false
getgenv().AntiDetection = true

-- // Anti-Detection Functions
local function AddRandomHumanMovement()
    if not getgenv().AntiDetection or not Character or not Humanoid then return end
    
    spawn(function()
        local randomWait = math.random(30, 120) -- Random wait between 30-120 seconds
        wait(randomWait)
        
        if Humanoid and HumanoidRootPart then
            -- Random small movements
            local randomDirection = Vector3.new(
                math.random(-20, 20),
                0,
                math.random(-20, 20)
            )
            
            local originalPosition = HumanoidRootPart.Position
            HumanoidRootPart.CFrame = CFrame.new(originalPosition + randomDirection)
            wait(0.5)
            HumanoidRootPart.CFrame = CFrame.new(originalPosition)
        end
    end)
end

local function RandomizeStats()
    if not getgenv().AntiDetection or not Humanoid then return end
    
    spawn(function()
        while getgenv().AntiDetection do
            wait(math.random(45, 90))
            if Humanoid then
                -- Slightly randomize walkspeed to appear more human
                local variation = math.random(-2, 2)
                Humanoid.WalkSpeed = math.max(14, math.min(18, OriginalWalkSpeed + variation))
            end
        end
    end)
end

local function AntiDetectionDelay()
    if getgenv().AntiDetection then
        wait(math.random(50, 150) / 1000) -- Random delay 50-150ms
    end
end

-- // Enhanced Teleport with Anti-Detection
local function SafeTeleport(position, instant)
    if not HumanoidRootPart then return false end
    
    local currentTime = tick()
    if getgenv().AntiDetection then
        -- Prevent rapid teleporting
        if currentTime - DetectionCounters.LastTeleport < 1 then
            wait(1 - (currentTime - DetectionCounters.LastTeleport))
        end
        
        DetectionCounters.TeleportCount = DetectionCounters.TeleportCount + 1
        DetectionCounters.LastTeleport = currentTime
        
        -- Add random delay for larger teleports
        if DetectionCounters.TeleportCount % 5 == 0 then
            wait(math.random(1, 3))
        end
    end
    
    pcall(function()
        if instant then
            HumanoidRootPart.CFrame = CFrame.new(position)
        else
            -- Smooth teleport with tween for short distances
            local distance = (HumanoidRootPart.Position - position).Magnitude
            if distance < 50 and getgenv().AntiDetection then
                local tween = TweenService:Create(
                    HumanoidRootPart,
                    TweenInfo.new(distance / 50, Enum.EasingStyle.Linear),
                    {CFrame = CFrame.new(position)}
                )
                tween:Play()
                tween.Completed:Wait()
            else
                HumanoidRootPart.CFrame = CFrame.new(position)
            end
        end
    end)
    
    return true
end

-- // Enhanced Fast Attack with Extended Hitbox
local FastAttackConnection
local function StartEnhancedFastAttack()
    if FastAttackConnection then
        FastAttackConnection:Disconnect()
    end
    
    FastAttackConnection = RunService.Heartbeat:Connect(function()
        if getgenv().AutoFastAttack then
            pcall(function()
                UpdateCharacter()
                if not Character or not HumanoidRootPart or not Humanoid then return end
                
                local tool = Character:FindFirstChildOfClass("Tool")
                if not tool then
                    EquipWeapon(getgenv().SelectedWeapon)
                    return
                end
                
                AntiDetectionDelay()
                
                -- Enhanced attack system with extended range
                local attackRange = 100 -- 100 studs range as requested
                local enemiesInRange = {}
                
                -- Find all enemies within extended range
                for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                    if enemy:FindFirstChild("HumanoidRootPart") and enemy:FindFirstChild("Humanoid") then
                        local enemyHumanoid = enemy.Humanoid
                        local enemyRoot = enemy.HumanoidRootPart
                        
                        if enemyHumanoid.Health > 0 then
                            local distance = (HumanoidRootPart.Position - enemyRoot.Position).Magnitude
                            if distance <= attackRange then
                                table.insert(enemiesInRange, {enemy = enemy, distance = distance})
                            end
                        end
                    end
                end
                
                -- Sort enemies by distance (closest first)
                table.sort(enemiesInRange, function(a, b) return a.distance < b.distance end)
                
                -- Attack all enemies in range with enhanced damage
                for i, enemyData in pairs(enemiesInRange) do
                    local enemy = enemyData.enemy
                    if i <= 10 then -- Limit to 10 enemies per frame for performance
                        local args = {
                            [1] = "weaponChange",
                            [2] = tool.Name
                        }
                        
                        -- Multiple attack methods for maximum effectiveness
                        pcall(function()
                            game:GetService("ReplicatedStorage"):FindFirstChild("RigControllerEvent"):FireServer(unpack(args))
                        end)
                        
                        -- Enhanced hit registration
                        local hitArgs = {
                            [1] = "hit",
                            [2] = {
                                ["Name"] = tool.Name,
                                ["Target"] = enemy.HumanoidRootPart,
                                ["RigType"] = Character.Humanoid.RigType,
                                ["Dmg"] = math.random(1000, 5000) -- Enhanced damage
                            }
                        }
                        
                        pcall(function()
                            game:GetService("ReplicatedStorage"):FindFirstChild("RigControllerEvent"):FireServer(unpack(hitArgs))
                        end)
                        
                        -- Additional attack methods
                        pcall(function()
                            local remotes = ReplicatedStorage:FindFirstChild("Remotes")
                            if remotes then
                                local commF = remotes:FindFirstChild("CommF_")
                                if commF then
                                    commF:InvokeServer("weaponChange", tool.Name)
                                end
                            end
                        end)
                    end
                end
                
                -- Virtual input for additional attack registration
                if #enemiesInRange > 0 then
                    local camera = workspace.CurrentCamera
                    local screenCenter = camera.ViewportSize / 2
                    VirtualInputManager:SendMouseButtonEvent(screenCenter.X, screenCenter.Y, 0, true, game, 1)
                    wait(0.01)
                    VirtualInputManager:SendMouseButtonEvent(screenCenter.X, screenCenter.Y, 0, false, game, 1)
                end
                
                DetectionCounters.AttackCount = DetectionCounters.AttackCount + 1
                DetectionCounters.LastAttack = tick()
            end)
        end
    end)
end

-- // Enhanced Bring Mobs Function
local BringMobConnection
local function StartBringMobs()
    if BringMobConnection then
        BringMobConnection:Disconnect()
    end
    
    BringMobConnection = RunService.Heartbeat:Connect(function()
        if getgenv().AutoBringMobs and HumanoidRootPart then
            pcall(function()
                local bringRange = 150 -- Range to bring mobs from
                local bringPosition = HumanoidRootPart.Position + Vector3.new(0, 0, 5) -- Slightly in front of player
                
                for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                    if enemy:FindFirstChild("HumanoidRootPart") and enemy:FindFirstChild("Humanoid") then
                        local enemyRoot = enemy.HumanoidRootPart
                        local enemyHumanoid = enemy.Humanoid
                        
                        if enemyHumanoid.Health > 0 then
                            local distance = (HumanoidRootPart.Position - enemyRoot.Position).Magnitude
                            
                            if distance <= bringRange and distance > 15 then -- Don't bring mobs too close
                                -- Disable enemy AI
                                enemyHumanoid.WalkSpeed = 0
                                enemyHumanoid.JumpPower = 0
                                enemyHumanoid.PlatformStand = true
                                
                                -- Enhanced position setting with rotation
                                local angle = math.random(0, 360)
                                local radius = math.random(8, 12)
                                local x = bringPosition.X + radius * math.cos(math.rad(angle))
                                local z = bringPosition.Z + radius * math.sin(math.rad(angle))
                                
                                enemyRoot.CFrame = CFrame.new(Vector3.new(x, bringPosition.Y, z))
                                enemyRoot.Velocity = Vector3.new(0, 0, 0)
                                enemyRoot.AngularVelocity = Vector3.new(0, 0, 0)
                                
                                -- Disable collisions
                                for _, part in pairs(enemy:GetChildren()) do
                                    if part:IsA("BasePart") then
                                        part.CanCollide = false
                                    end
                                end
                            end
                        end
                    end
                end
            end)
        end
    end)
end

-- // Enhanced Weapon Equipping
local function EquipWeapon(weaponName)
    pcall(function()
        UpdateCharacter()
        if not Character or not Humanoid then return false end
        
        -- Unequip current tools
        for _, tool in pairs(Character:GetChildren()) do
            if tool:IsA("Tool") then
                tool.Parent = Player.Backpack
            end
        end
        
        wait(0.1)
        
        -- Find and equip weapon
        local weapon = Player.Backpack:FindFirstChild(weaponName)
        if weapon and weapon:IsA("Tool") then
            weapon.Parent = Character
            wait(0.1) -- Wait for weapon to be equipped
            return true
        end
        
        -- Combat alternatives
        if weaponName == "Combat" then
            local combatWeapons = {"Combat", "Superhuman", "Dark Step", "Electric", "Water Kung Fu", "Dragon Breath", "Fishman Karate"}
            for _, combatName in pairs(combatWeapons) do
                local combat = Player.Backpack:FindFirstChild(combatName)
                if combat then
                    combat.Parent = Character
                    wait(0.1)
                    return true
                end
            end
        end
    end)
    return false
end

-- // Complete and Fixed Quest Data for Sea 1
local QuestData = {
    {Level = 1, Name = "Bandit", QuestGiver = "Bandit Quest", Enemy = "Bandit", QuestLocation = Vector3.new(1059.37, 15.4, 1550.42), EnemySpawn = Vector3.new(1045, 14, 1563)},
    {Level = 10, Name = "Monkey", QuestGiver = "Jungle Quest", Enemy = "Monkey", QuestLocation = Vector3.new(-1448.51, 67.85, 11.46), EnemySpawn = Vector3.new(-1448, 50, 11)},
    {Level = 15, Name = "Gorilla", QuestGiver = "Jungle Quest", Enemy = "Gorilla", QuestLocation = Vector3.new(-1448.51, 67.85, 11.46), EnemySpawn = Vector3.new(-1129, 40, -515)},
    {Level = 20, Name = "Pirate", QuestGiver = "Pirate Quest", Enemy = "Pirate", QuestLocation = Vector3.new(-1141.07, 4.78, 3831.99), EnemySpawn = Vector3.new(-1103, 13, 3896)},
    {Level = 30, Name = "Brute", QuestGiver = "Pirate Quest", Enemy = "Brute", QuestLocation = Vector3.new(-1141.07, 4.78, 3831.99), EnemySpawn = Vector3.new(-1140, 15, 4314)},
    {Level = 40, Name = "Desert Bandit", QuestGiver = "Desert Quest", Enemy = "Desert Bandit", QuestLocation = Vector3.new(894.49, 5.14, 4392.43), EnemySpawn = Vector3.new(924, 7, 4481)},
    {Level = 60, Name = "Desert Officer", QuestGiver = "Desert Quest", Enemy = "Desert Officer", QuestLocation = Vector3.new(894.49, 5.14, 4392.43), EnemySpawn = Vector3.new(1608, 7, 4371)},
    {Level = 75, Name = "Snow Bandit", QuestGiver = "Snow Quest", Enemy = "Snow Bandit", QuestLocation = Vector3.new(1389.74, 88.15, -1298.90), EnemySpawn = Vector3.new(1354, 87, -1352)},
    {Level = 90, Name = "Snowman", QuestGiver = "Snow Quest", Enemy = "Snowman", QuestLocation = Vector3.new(1389.74, 88.15, -1298.90), EnemySpawn = Vector3.new(1201, 87, -1502)},
    {Level = 100, Name = "Chief Petty Officer", QuestGiver = "Marine Quest", Enemy = "Chief Petty Officer", QuestLocation = Vector3.new(-5039.58, 27.34, 4324.68), EnemySpawn = Vector3.new(-4882, 23, 4255)},
    {Level = 120, Name = "Sky Bandit", QuestGiver = "Sky Quest", Enemy = "Sky Bandit", QuestLocation = Vector3.new(-4839.53, 717.67, -2619.44), EnemySpawn = Vector3.new(-4970, 717, -2888)},
    {Level = 150, Name = "Dark Master", QuestGiver = "Sky Quest", Enemy = "Dark Master", QuestLocation = Vector3.new(-4839.53, 717.67, -2619.44), EnemySpawn = Vector3.new(-5259, 717, -2221)},
    {Level = 200, Name = "Prisoner", QuestGiver = "Prison Quest", Enemy = "Prisoner", QuestLocation = Vector3.new(5308.93, 1.65, 475.12), EnemySpawn = Vector3.new(5411, 96, 690)},
    {Level = 250, Name = "Dangerous Prisoner", QuestGiver = "Prison Quest", Enemy = "Dangerous Prisoner", QuestLocation = Vector3.new(5308.93, 1.65, 475.12), EnemySpawn = Vector3.new(5411, 96, 690)},
    {Level = 300, Name = "Toga Warrior", QuestGiver = "Colosseum Quest", Enemy = "Toga Warrior", QuestLocation = Vector3.new(-1427.6, 8.7, -2792.5), EnemySpawn = Vector3.new(-1770, 8, -2777)},
    {Level = 325, Name = "Gladiator", QuestGiver = "Colosseum Quest", Enemy = "Gladiator", QuestLocation = Vector3.new(-1427.6, 8.7, -2792.5), EnemySpawn = Vector3.new(-1770, 8, -2777)},
    {Level = 350, Name = "Military Soldier", QuestGiver = "Magma Quest", Enemy = "Military Soldier", QuestLocation = Vector3.new(-5313.37, 10.9, 8515.29), EnemySpawn = Vector3.new(-5411, 11, 8549)},
    {Level = 400, Name = "Military Spy", QuestGiver = "Magma Quest", Enemy = "Military Spy", QuestLocation = Vector3.new(-5313.37, 10.9, 8515.29), EnemySpawn = Vector3.new(-5802, 87, 8860)},
    {Level = 450, Name = "Fishman Warrior", QuestGiver = "Underwater City Quest", Enemy = "Fishman Warrior", QuestLocation = Vector3.new(61123.05, 18.5, 1569.3), EnemySpawn = Vector3.new(60878, 19, 1449)},
    {Level = 475, Name = "Fishman Commando", QuestGiver = "Underwater City Quest", Enemy = "Fishman Commando", QuestLocation = Vector3.new(61123.05, 18.5, 1569.3), EnemySpawn = Vector3.new(61922, 19, 1808)},
    {Level = 500, Name = "God's Guard", QuestGiver = "Sky Island Quest", Enemy = "God's Guard", QuestLocation = Vector3.new(-4721.88, 845.38, -1949.96), EnemySpawn = Vector3.new(-4628, 873, -1926)},
    {Level = 525, Name = "Shanda", QuestGiver = "Sky Island Quest", Enemy = "Shanda", QuestLocation = Vector3.new(-7859.09, 5544.19, -381.476), EnemySpawn = Vector3.new(-7678, 5567, -446)},
    {Level = 550, Name = "Royal Squad", QuestGiver = "Sky Island Quest", Enemy = "Royal Squad", QuestLocation = Vector3.new(-7906.81, 5634.6, -1411.99), EnemySpawn = Vector3.new(-7555, 5637, -1407)},
    {Level = 575, Name = "Royal Soldier", QuestGiver = "Sky Island Quest", Enemy = "Royal Soldier", QuestLocation = Vector3.new(-7906.81, 5634.6, -1411.99), EnemySpawn = Vector3.new(-7837, 5637, -1456)},
    {Level = 600, Name = "Galley Pirate", QuestGiver = "Fountain City Quest", Enemy = "Galley Pirate", QuestLocation = Vector3.new(5259.81, 1, 3364.83), EnemySpawn = Vector3.new(5551, 152, 3972)}
}

-- // Enhanced Boss Data with Better Spawn Locations
local BossData = {
    ["The Gorilla King"] = {
        Name = "The Gorilla King",
        Level = 25,
        SpawnLocation = Vector3.new(-1129, 40, -515),
        SpawnTime = 600, -- 10 minutes
        QuestGiver = Vector3.new(-1448.51, 67.85, 11.46)
    },
    ["Bobby"] = {
        Name = "Bobby",
        Level = 55,
        SpawnLocation = Vector3.new(-1140, 15, 4314),
        SpawnTime = 600,
        QuestGiver = Vector3.new(-1141.07, 4.78, 3831.99)
    },
    ["Yeti"] = {
        Name = "Yeti",
        Level = 110,
        SpawnLocation = Vector3.new(1201, 87, -1502),
        SpawnTime = 600,
        QuestGiver = Vector3.new(1389.74, 88.15, -1298.90)
    },
    ["Mob Leader"] = {
        Name = "Mob Leader",
        Level = 120,
        SpawnLocation = Vector3.new(-2848, 7, 5342),
        SpawnTime = 600,
        QuestGiver = Vector3.new(-2777, 8, 5343)
    },
    ["Vice Admiral"] = {
        Name = "Vice Admiral",
        Level = 130,
        SpawnLocation = Vector3.new(-5026, 29, 4324),
        SpawnTime = 600,
        QuestGiver = Vector3.new(-5039.58, 27.34, 4324.68)
    },
    ["Warden"] = {
        Name = "Warden",
        Level = 220,
        SpawnLocation = Vector3.new(5278, 3, 473),
        SpawnTime = 600,
        QuestGiver = Vector3.new(5308.93, 1.65, 475.12)
    },
    ["Chief Warden"] = {
        Name = "Chief Warden",
        Level = 200,
        SpawnLocation = Vector3.new(5206, 1, 438),
        SpawnTime = 600,
        QuestGiver = Vector3.new(5308.93, 1.65, 475.12)
    },
    ["Swan"] = {
        Name = "Swan",
        Level = 240,
        SpawnLocation = Vector3.new(5230, 4, 749),
        SpawnTime = 600,
        QuestGiver = Vector3.new(5308.93, 1.65, 475.12)
    },
    ["Magma Admiral"] = {
        Name = "Magma Admiral",
        Level = 350,
        SpawnLocation = Vector3.new(-5530, 12, 8610),
        SpawnTime = 600,
        QuestGiver = Vector3.new(-5313.37, 10.9, 8515.29)
    },
    ["Fishman Lord"] = {
        Name = "Fishman Lord",
        Level = 425,
        SpawnLocation = Vector3.new(61351, 31, 1095),
        SpawnTime = 600,
        QuestGiver = Vector3.new(61123.05, 18.5, 1569.3)
    },
    ["Wysper"] = {
        Name = "Wysper",
        Level = 500,
        SpawnLocation = Vector3.new(-7925, 5550, -636),
        SpawnTime = 600,
        QuestGiver = Vector3.new(-7859.09, 5544.19, -381.476)
    },
    ["Thunder God"] = {
        Name = "Thunder God",
        Level = 575,
        SpawnLocation = Vector3.new(-7748, 5607, -2305),
        SpawnTime = 600,
        QuestGiver = Vector3.new(-7906.81, 5634.6, -1411.99)
    },
    ["Cyborg"] = {
        Name = "Cyborg",
        Level = 675,
        SpawnLocation = Vector3.new(6041, 52, 3907),
        SpawnTime = 600,
        QuestGiver = Vector3.new(5259.81, 1, 3364.83)
    }
}

-- // Enhanced Player Level Function
local function GetPlayerLevel()
    local success, level = pcall(function()
        return Player.Data.Level.Value
    end)
    if success then
        return level
    else
        -- Alternative method
        local success2, level2 = pcall(function()
            return Player.leaderstats.Level.Value
        end)
        return success2 and level2 or 1
    end
end

-- // Enhanced Quest System with Better Logic
local function GetCurrentQuest()
    pcall(function()
        local playerLevel = GetPlayerLevel()
        for i = #QuestData, 1, -1 do
            if playerLevel >= QuestData[i].Level then
                return QuestData[i]
            end
        end
    end)
    return QuestData[1] -- Default to first quest
end

local function HasQuest(questName)
    local success, result = pcall(function()
        local questFolder = Player.PlayerGui:FindFirstChild("Main"):FindFirstChild("Quest")
        if questFolder and questFolder.Visible then
            local questTitle = questFolder:FindFirstChild("Container"):FindFirstChild("QuestTitle")
            if questTitle then
                return string.find(questTitle.Title.Text, questName) ~= nil
            end
        end
        return false
    end)
    return success and result
end

local function AcceptQuest(questData)
    if not questData or HasQuest(questData.Name) then return end
    
    pcall(function()
        SafeTeleport(questData.QuestLocation)
        wait(1)
        
        -- Find quest giver NPC
        local questGiver = nil
        for _, npc in pairs(Workspace.NPCs:GetChildren()) do
            if string.find(npc.Name, questData.QuestGiver) then
                questGiver = npc
                break
            end
        end
        
        if questGiver and questGiver:FindFirstChild("HumanoidRootPart") then
            -- Get closer to quest giver
            local distance = (HumanoidRootPart.Position - questGiver.HumanoidRootPart.Position).Magnitude
            if distance > 10 then
                SafeTeleport(questGiver.HumanoidRootPart.Position + Vector3.new(0, 0, 5))
                wait(0.5)
            end
            
            -- Multiple methods to accept quest
            local remotes = ReplicatedStorage:FindFirstChild("Remotes")
            if remotes then
                local commF = remotes:FindFirstChild("CommF_")
                if commF then
                    commF:InvokeServer("StartQuest", questData.Name, 1)
                    wait(0.5)
                    commF:InvokeServer("StartQuest", questData.Name, 2)
                end
            end
        end
    end)
end

-- // Enhanced Level Farming with Better Logic
local LevelFarmConnection
local function StartLevelFarming()
    if LevelFarmConnection then
        LevelFarmConnection:Disconnect()
    end
    
    LevelFarmConnection = RunService.Heartbeat:Connect(function()
        if getgenv().AutoFarmLevel then
            pcall(function()
                UpdateCharacter()
                if not Character or not HumanoidRootPart then return end
                
                local currentQuest = GetCurrentQuest()
                if not currentQuest then return end
                
                -- Accept quest if we don't have it
                if not HasQuest(currentQuest.Name) then
                    AcceptQuest(currentQuest)
                    wait(2)
                    return
                end
                
                -- Equip weapon
                if not Character:FindFirstChildOfClass("Tool") then
                    EquipWeapon(getgenv().SelectedWeapon)
                    wait(0.5)
                end
                
                -- Find target enemies
                local targetEnemies = {}
                for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                    if enemy.Name == currentQuest.Enemy and enemy:FindFirstChild("Humanoid") and enemy:FindFirstChild("HumanoidRootPart") then
                        if enemy.Humanoid.Health > 0 then
                            table.insert(targetEnemies, enemy)
                        end
                    end
                end
                
                -- If no enemies found, go to spawn location
                if #targetEnemies == 0 then
                    local spawnDistance = (HumanoidRootPart.Position - currentQuest.EnemySpawn).Magnitude
                    if spawnDistance > 20 then
                        SafeTeleport(currentQuest.EnemySpawn)
                        wait(2)
                    end
                    return
                end
                
                -- Attack closest enemy
                local closestEnemy = nil
                local closestDistance = math.huge
                
                for _, enemy in pairs(targetEnemies) do
                    local distance = (HumanoidRootPart.Position - enemy.HumanoidRootPart.Position).Magnitude
                    if distance < closestDistance then
                        closestDistance = distance
                        closestEnemy = enemy
                    end
                end
                
                if closestEnemy then
                    -- Move to enemy if too far
                    if closestDistance > 50 then
                        SafeTeleport(closestEnemy.HumanoidRootPart.Position + Vector3.new(0, 0, 20))
                        wait(0.5)
                    end
                    
                    -- Face the enemy
                    local lookDirection = (closestEnemy.HumanoidRootPart.Position - HumanoidRootPart.Position).Unit
                    HumanoidRootPart.CFrame = CFrame.lookAt(HumanoidRootPart.Position, HumanoidRootPart.Position + lookDirection)
                end
            end)
        end
    end)
end

-- // Enhanced Boss Farming with Better Targeting
local BossFarmConnection
local function StartBossFarming()
    if BossFarmConnection then
        BossFarmConnection:Disconnect()
    end
    
    BossFarmConnection = RunService.Heartbeat:Connect(function()
        if getgenv().AutoBossFarm and getgenv().SelectedBoss ~= "" then
            pcall(function()
                UpdateCharacter()
                if not Character or not HumanoidRootPart then return end
                
                local bossData = BossData[getgenv().SelectedBoss]
                if not bossData then return end
                
                -- Equip weapon
                if not Character:FindFirstChildOfClass("Tool") then
                    EquipWeapon(getgenv().SelectedWeapon)
                    wait(0.5)
                end
                
                -- Find boss
                local boss = nil
                for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                    if enemy.Name == bossData.Name and enemy:FindFirstChild("Humanoid") and enemy:FindFirstChild("HumanoidRootPart") then
                        if enemy.Humanoid.Health > 0 then
                            boss = enemy
                            break
                        end
                    end
                end
                
                -- Check ReplicatedStorage for boss
                if not boss then
                    for _, enemy in pairs(ReplicatedStorage:GetChildren()) do
                        if enemy.Name == bossData.Name and enemy:FindFirstChild("Humanoid") and enemy:FindFirstChild("HumanoidRootPart") then
                            if enemy.Humanoid.Health > 0 then
                                boss = enemy
                                break
                            end
                        end
                    end
                end
                
                if boss then
                    local distance = (HumanoidRootPart.Position - boss.HumanoidRootPart.Position).Magnitude
                    
                    -- Enhanced boss fighting strategy
                    if distance > 100 then
                        -- Teleport closer to boss
                        SafeTeleport(boss.HumanoidRootPart.Position + Vector3.new(0, 20, 0))
                        wait(0.5)
                    elseif distance > 25 then
                        -- Move closer but maintain distance for safety
                        SafeTeleport(boss.HumanoidRootPart.Position + Vector3.new(0, 0, 25))
                    end
                    
                    -- Face the boss for better accuracy
                    local lookDirection = (boss.HumanoidRootPart.Position - HumanoidRootPart.Position).Unit
                    HumanoidRootPart.CFrame = CFrame.lookAt(HumanoidRootPart.Position, HumanoidRootPart.Position + lookDirection)
                    
                    -- Enhanced boss attack with special techniques
                    local tool = Character:FindFirstChildOfClass("Tool")
                    if tool then
                        -- Multi-hit attack system for bosses
                        for i = 1, 3 do
                            local args = {
                                [1] = "weaponChange",
                                [2] = tool.Name
                            }
                            game:GetService("ReplicatedStorage"):FindFirstChild("RigControllerEvent"):FireServer(unpack(args))
                            
                            local hitArgs = {
                                [1] = "hit",
                                [2] = {
                                    ["Name"] = tool.Name,
                                    ["Target"] = boss.HumanoidRootPart,
                                    ["RigType"] = Character.Humanoid.RigType,
                                    ["Dmg"] = math.random(2000, 8000) -- Higher damage for bosses
                                }
                            }
                            game:GetService("ReplicatedStorage"):FindFirstChild("RigControllerEvent"):FireServer(unpack(hitArgs))
                            wait(0.05)
                        end
                    end
                else
                    -- Boss not found, go to spawn location
                    local spawnDistance = (HumanoidRootPart.Position - bossData.SpawnLocation).Magnitude
                    if spawnDistance > 30 then
                        SafeTeleport(bossData.SpawnLocation)
                        wait(3) -- Wait longer for boss to spawn
                    end
                end
            end)
        end
    end)
end

-- // Fixed Teleport Locations
local TeleportLocations = {
    -- Fixed Jungle location (was glitching)
    ["Jungle"] = Vector3.new(-1448.51, 67.85, 11.46),
    ["Pirate Village"] = Vector3.new(-1141.07, 4.78, 3831.99),
    ["Desert"] = Vector3.new(894.49, 5.14, 4392.43),
    ["Snow Island"] = Vector3.new(1389.74, 88.15, -1298.90),
    ["Marine Base"] = Vector3.new(-5039.58, 27.34, 4324.68),
    ["Sky Island"] = Vector3.new(-4839.53, 717.67, -2619.44),
    ["Prison"] = Vector3.new(5308.93, 1.65, 475.12),
    ["Colosseum"] = Vector3.new(-1427.6, 8.7, -2792.5),
    ["Magma Village"] = Vector3.new(-5313.37, 10.9, 8515.29),
    ["Underwater City"] = Vector3.new(61123.05, 18.5, 1569.3),
    ["Upper Sky"] = Vector3.new(-7859.09, 5544.19, -381.476),
    ["Fountain City"] = Vector3.new(5259.81, 1, 3364.83),
    ["Starter Island"] = Vector3.new(1059.37, 15.4, 1550.42)
}

-- // Auto Armament Haki with Enhanced Logic
local function ActivateHaki()
    spawn(function()
        while getgenv().AutoArmamentHaki do
            pcall(function()
                UpdateCharacter()
                if Character and not Character:FindFirstChild("HasBuso") then
                    local remotes = ReplicatedStorage:FindFirstChild("Remotes")
                    if remotes then
                        local commF = remotes:FindFirstChild("CommF_")
                        if commF then
                            commF:InvokeServer("Buso")
                        end
                    end
                end
            end)
            wait(0.5) -- Reduced wait time for better responsiveness
        end
    end)
end

-- // UI Creation with Enhanced Design
local ScreenGui = Instance.new("ScreenGui")
local ImageButton = Instance.new("ImageButton")
local UICorner = Instance.new("UICorner")
local UIStroke = Instance.new("UIStroke")
local UIGradient = Instance.new("UIGradient")
local UIScale = Instance.new("UIScale")

ScreenGui.Name = "EnchantedHubButton"
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

ImageButton.Parent = ScreenGui
ImageButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ImageButton.BackgroundTransparency = Button_Transparency
ImageButton.BorderSizePixel = 0
ImageButton.Position = UDim2.new(0.05, 0, 0.1, 0)
ImageButton.Size = UDim2.new(0, 70, 0, 70)
ImageButton.Image = Button_Icon
ImageButton.Draggable = true
ImageButton.ImageTransparency = 0

UICorner.CornerRadius = UDim.new(0, 20)
UICorner.Parent = ImageButton

UIStroke.Parent = ImageButton
UIStroke.Color = Color3.fromRGB(0, 150, 255)
UIStroke.Thickness = 4
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

UIGradient.Parent = ImageButton
UIGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(135, 206, 250)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(70, 130, 180))
}
UIGradient.Rotation = 45

UIScale.Parent = ImageButton
UIScale.Scale = 1

-- // Enhanced Button Animation
local function animateButton()
    local tween1 = TweenService:Create(
        UIScale,
        TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
        {Scale = 0.8}
    )
    tween1:Play()
    tween1.Completed:Connect(function()
        local tween2 = TweenService:Create(
            UIScale,
            TweenInfo.new(0.1, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
            {Scale = 1.1}
        )
        tween2:Play()
        tween2.Completed:Connect(function()
            local tween3 = TweenService:Create(
                UIScale,
                TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Scale = 1}
            )
            tween3:Play()
        end)
    end)
end

-- // Load UI after delay
wait(3)

-- // Load Fluent UI Library
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "ENCHANTED HUB | BLOX FRUIT SEA 1 [ENHANCED]",
    SubTitle = "Created by AABIS & moha | Anti-Detection Enabled",
    TabWidth = 140,
    Size = UDim2.fromOffset(650, 550),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- // Enhanced Tabs
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" }),
    AutoFarm = Window:AddTab({ Title = "Auto Farm", Icon = "fan" }),
    Combat = Window:AddTab({ Title = "Combat", Icon = "sword" }),
    Boss = Window:AddTab({ Title = "Boss Farm", Icon = "crown" }),
    Teleport = Window:AddTab({ Title = "Teleport", Icon = "map-pin" }),
    AntiDetection = Window:AddTab({ Title = "Anti-Detection", Icon = "shield" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

-- // Toggle Function
local isHidden = false
ImageButton.MouseButton1Click:Connect(function()
    animateButton()
    wait(0.2)
    if Window and Window.Root then
        if isHidden then
            Window.Root.Visible = true
            isHidden = false
        else
            Window.Root.Visible = false
            isHidden = true
        end
    end
end)

-- // Main Tab
Tabs.Main:AddParagraph({
    Title = "Enhanced Blox Fruits Script",
    Content = "This is an improved version with anti-detection, enhanced fast attack with 100 studs range, better bring mobs, proper level farming logic, and fixed teleport locations."
})

local PlayerStats = Tabs.Main:AddParagraph({
    Title = "Player Stats",
    Content = "Loading..."
})

-- Update player stats
spawn(function()
    while true do
        local stats = pcall(function()
            local level = GetPlayerLevel()
            local money = Player.Data.Beli.Value or 0
            local race = Player.Data.Race.Value or "Human"
            
            PlayerStats:SetDesc(string.format("Level: %d | Money: %s | Race: %s", level, tostring(money), race))
        end)
        wait(5)
    end
end)

-- // Auto Farm Tab
Tabs.AutoFarm:AddToggle("AutoFarmLevel", {
    Title = "Auto Farm Level",
    Description = "Automatically farm levels with proper quest logic",
    Default = false,
    Callback = function(Value)
        getgenv().AutoFarmLevel = Value
        if Value then
            StartLevelFarming()
        elseif LevelFarmConnection then
            LevelFarmConnection:Disconnect()
        end
    end
})

local WeaponDropdown = Tabs.AutoFarm:AddDropdown("WeaponSelect", {
    Title = "Select Weapon",
    Description = "Choose your farming weapon",
    Values = {"Combat", "Sword", "Fruit", "Gun"},
    Multi = false,
    Default = 1,
    Callback = function(Value)
        getgenv().SelectedWeapon = Value
    end
})

Tabs.AutoFarm:AddButton({
    Title = "Refresh Weapons",
    Description = "Update weapon list from inventory",
    Callback = function()
        local weapons = {"Combat", "Sword", "Fruit", "Gun"}
        pcall(function()
            for _, tool in pairs(Player.Backpack:GetChildren()) do
                if tool:IsA("Tool") and not table.find(weapons, tool.Name) then
                    table.insert(weapons, tool.Name)
                end
            end
            if Character then
                for _, tool in pairs(Character:GetChildren()) do
                    if tool:IsA("Tool") and not table.find(weapons, tool.Name) then
                        table.insert(weapons, tool.Name)
                    end
                end
            end
        end)
        WeaponDropdown:SetValues(weapons)
    end
})

-- // Combat Tab
Tabs.Combat:AddToggle("AutoFastAttack", {
    Title = "Enhanced Fast Attack",
    Description = "Extended 100 studs hitbox with anti-detection",
    Default = false,
    Callback = function(Value)
        getgenv().AutoFastAttack = Value
        if Value then
            StartEnhancedFastAttack()
        elseif FastAttackConnection then
            FastAttackConnection:Disconnect()
        end
    end
})

Tabs.Combat:AddToggle("AutoBringMobs", {
    Title = "Enhanced Bring Mobs",
    Description = "Bring mobs to you with improved logic",
    Default = false,
    Callback = function(Value)
        getgenv().AutoBringMobs = Value
        if Value then
            StartBringMobs()
        elseif BringMobConnection then
            BringMobConnection:Disconnect()
        end
    end
})

Tabs.Combat:AddToggle("AutoArmamentHaki", {
    Title = "Auto Armament Haki",
    Description = "Automatically activate Armament Haki",
    Default = false,
    Callback = function(Value)
        getgenv().AutoArmamentHaki = Value
        if Value then
            ActivateHaki()
        end
    end
})

-- // Boss Farm Tab
Tabs.Boss:AddToggle("AutoBossFarm", {
    Title = "Enhanced Boss Farm",
    Description = "Farm bosses with better targeting and strategy",
    Default = false,
    Callback = function(Value)
        getgenv().AutoBossFarm = Value
        if Value then
            StartBossFarming()
        elseif BossFarmConnection then
            BossFarmConnection:Disconnect()
        end
    end
})

local BossNames = {}
for bossName, _ in pairs(BossData) do
    table.insert(BossNames, bossName)
end

Tabs.Boss:AddDropdown("BossSelect", {
    Title = "Select Boss",
    Description = "Choose which boss to farm",
    Values = BossNames,
    Multi = false,
    Default = 1,
    Callback = function(Value)
        getgenv().SelectedBoss = Value
    end
})

Tabs.Boss:AddButton({
    Title = "Teleport to Selected Boss",
    Description = "Instantly teleport to the selected boss location",
    Callback = function()
        if getgenv().SelectedBoss ~= "" then
            local bossData = BossData[getgenv().SelectedBoss]
            if bossData then
                SafeTeleport(bossData.SpawnLocation)
            end
        end
    end
})

-- // Teleport Tab
for locationName, position in pairs(TeleportLocations) do
    Tabs.Teleport:AddButton({
        Title = "Teleport to " .. locationName,
        Description = "Safe teleport with anti-detection",
        Callback = function()
            SafeTeleport(position)
        end
    })
end

-- // Anti-Detection Tab
Tabs.AntiDetection:AddToggle("AntiDetectionEnabled", {
    Title = "Anti-Detection System",
    Description = "Enable advanced anti-detection measures",
    Default = true,
    Callback = function(Value)
        getgenv().AntiDetection = Value
        if Value then
            RandomizeStats()
            spawn(function()
                while getgenv().AntiDetection do
                    AddRandomHumanMovement()
                    wait(math.random(60, 180))
                end
            end)
        end
    end
})

local DetectionStatus = Tabs.AntiDetection:AddParagraph({
    Title = "Detection Status",
    Content = "Monitoring..."
})

spawn(function()
    while true do
        if getgenv().AntiDetection then
            local status = string.format(
                "Teleports: %d | Attacks: %d | Status: PROTECTED",
                DetectionCounters.TeleportCount,
                DetectionCounters.AttackCount
            )
            DetectionStatus:SetDesc(status)
        else
            DetectionStatus:SetDesc("Anti-Detection: DISABLED")
        end
        wait(2)
    end
end)

Tabs.AntiDetection:AddButton({
    Title = "Reset Detection Counters",
    Description = "Reset all detection counters",
    Callback = function()
        DetectionCounters.TeleportCount = 0
        DetectionCounters.AttackCount = 0
        DetectionCounters.LastTeleport = 0
        DetectionCounters.LastAttack = 0
    end
})

-- // Settings Tab
Tabs.Settings:AddButton({
    Title = "Update Character",
    Description = "Refresh character references",
    Callback = function()
        UpdateCharacter()
    end
})

Tabs.Settings:AddSlider("WalkSpeedSlider", {
    Title = "Walk Speed",
    Description = "Adjust character walk speed",
    Default = 16,
    Min = 16,
    Max = 100,
    Rounding = 1,
    Callback = function(Value)
        if Humanoid then
            Humanoid.WalkSpeed = Value
            OriginalWalkSpeed = Value
        end
    end
})

Tabs.Settings:AddSlider("JumpPowerSlider", {
    Title = "Jump Power",
    Description = "Adjust character jump power",
    Default = 50,
    Min = 50,
    Max = 200,
    Rounding = 1,
    Callback = function(Value)
        if Humanoid then
            Humanoid.JumpPower = Value
            OriginalJumpPower = Value
        end
    end
})

-- // Start anti-detection by default
RandomizeStats()
spawn(function()
    while true do
        if getgenv().AntiDetection then
            AddRandomHumanMovement()
        end
        wait(math.random(60, 180))
    end
end)

-- // Final initialization
UpdateCharacter()
print("Enhanced Blox Fruits Script Loaded Successfully!")
print("Features: Anti-Detection, 100 Studs Fast Attack, Enhanced Boss Farm, Fixed Teleports")
