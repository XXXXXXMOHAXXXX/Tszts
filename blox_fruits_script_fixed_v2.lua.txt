local Show_Button = true
local Button_Icon = "rbxassetid://135671141026630"
local Button_Transparency = 0.1

-- Create Premium UI Button for Mobile
local ScreenGui = Instance.new("ScreenGui")
local ImageButton = Instance.new("ImageButton")
local UICorner = Instance.new("UICorner")
local UIStroke = Instance.new("UIStroke")
local UIGradient = Instance.new("UIGradient")
local UIScale = Instance.new("UIScale")

ScreenGui.Name = "SpaceHubButton"
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

ImageButton.Parent = ScreenGui
ImageButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ImageButton.BackgroundTransparency = Button_Transparency
ImageButton.BorderSizePixel = 0
ImageButton.Position = UDim2.new(0.05, 0, 0.1, 0)
ImageButton.Size = UDim2.new(0, 70, 0, 70)
ImageButton.Image = Button_Icon
ImageButton.Draggable = true
ImageButton.ImageTransparency = 0

-- Premium button styling
UICorner.CornerRadius = UDim.new(0, 20)
UICorner.Parent = ImageButton

UIStroke.Parent = ImageButton
UIStroke.Color = Color3.fromRGB(0, 150, 255)
UIStroke.Thickness = 4
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

UIGradient.Parent = ImageButton
UIGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(135, 206, 250)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(70, 130, 180))
}
UIGradient.Rotation = 45

UIScale.Parent = ImageButton
UIScale.Scale = 1

-- Enhanced button animations
local function animateButton()
    local tween1 = game:GetService("TweenService"):Create(
        UIScale,
        TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
        {Scale = 0.8}
    )
    tween1:Play()
    tween1.Completed:Connect(function()
        local tween2 = game:GetService("TweenService"):Create(
            UIScale,
            TweenInfo.new(0.1, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
            {Scale = 1.1}
        )
        tween2:Play()
        tween2.Completed:Connect(function()
            local tween3 = game:GetService("TweenService"):Create(
                UIScale,
                TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Scale = 1}
            )
            tween3:Play()
        end)
    end)
end

-- Hide/Show functionality
local isHidden = false
ImageButton.MouseButton1Click:Connect(function()
    animateButton()
    wait(0.2)
    if isHidden then
        for _, gui in pairs(game.CoreGui:GetChildren()) do
            if gui.Name == "ScreenGui" and gui:FindFirstChild("Frame") then
                gui.Enabled = true
            end
        end
        isHidden = false
    else
        for _, gui in pairs(game.CoreGui:GetChildren()) do
            if gui.Name == "ScreenGui" and gui:FindFirstChild("Frame") then
                gui.Enabled = false
            end
        end
        isHidden = true
    end
end)

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "SPACE HUB ULTIMATE - BLOX FRUIT v4.0",
    SubTitle = "Created by MOHA - Enhanced Premium Edition",
    TabWidth = 125,
    Size = UDim2.fromOffset(750, 600),
    Acrylic = true,
    Theme = "Aqua",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")

-- Wait for game to load properly
repeat wait() until game:IsLoaded()

-- Variables
local Player = Players.LocalPlayer
repeat wait() until Player.Character
local Character = Player.Character
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Combat Framework
local CombatFramework = require(ReplicatedStorage.CombatFramework)
local CombatFrameworkR = getupvalues(CombatFramework)[2]
local RigController = require(ReplicatedStorage.CombatFramework.RigLib)

-- Anti-Detection
local mt = getrawmetatable(game)
local oldnamecall = mt.__namecall
setreadonly(mt, false)
mt.__namecall = newcclosure(function(...)
    local args = {...}
    if getnamecallmethod() == "FireServer" then
        if tostring(args[1]) == "RemoteEvent" then
            if tostring(args[2]) ~= "true" and tostring(args[2]) ~= "false" then
                return
            end
        end
    end
    return oldnamecall(...)
end)
setreadonly(mt, true)

-- Global Variables
_G.AutoFarm = false
_G.FastAttack = false
_G.BringMobs = false
_G.AutoQuest = false
_G.AutoSaber = false
_G.AutoSecondSea = false
_G.AutoRaceV2 = false
_G.AutoRaceV3 = false
_G.AutoThirdSea = false
_G.AutoCDK = false
_G.AutoYama = false
_G.AutoTushita = false
_G.AutoBones = false
_G.AutoAllBoss = false
_G.AutoSelectedBoss = false
_G.AutoRipIndra = false
_G.AutoDoughKing = false
_G.AutoDoughPrince = false
_G.AutoRaid = false
_G.SoloRaid = false
_G.AimNearestPlayer = false
_G.SpectatePlayer = false
_G.AutoKitsuneIsland = false
_G.AutoAzure = false

-- Combat Variables
_G.SelectedWeapon = "Melee"
_G.SelectedBoss = "Gorilla King"
_G.SkillZ = false
_G.SkillX = false
_G.SkillC = false
_G.SkillV = false
_G.SkillF = false

-- Utility Functions
local function GetCurrentSea()
    local placeId = game.PlaceId
    if placeId == 2753915549 then
        return 1 -- First Sea
    elseif placeId == 4442272183 then
        return 2 -- Second Sea
    elseif placeId == 7449423635 then
        return 3 -- Third Sea
    end
    return 1
end

local function GetPlayerLevel()
    return Player.Data.Level.Value
end

local function GetPlayerMoney()
    return Player.Data.Beli.Value
end

local function GetPlayerRace()
    return Player.Data.Race.Value
end

local function GetPlayerBounty()
    return Player.leaderstats["Bounty/Honor"].Value
end

local function GetPlayerFragments()
    return Player.Data.Fragments.Value
end

local function TweenToPosition(position, speed)
    speed = speed or 500 -- Increased speed for faster farming
    local distance = (RootPart.Position - position).Magnitude
    local time = distance / speed
    
    if distance <= 10 then
        RootPart.CFrame = CFrame.new(position)
        return
    end
    
    local tween = TweenService:Create(
        RootPart,
        TweenInfo.new(time, Enum.EasingStyle.Linear),
        {CFrame = CFrame.new(position)}
    )
    tween:Play()
    return tween
end

local function GetNearestMob()
    local nearestMob = nil
    local shortestDistance = math.huge
    
    for _, mob in pairs(Workspace.Enemies:GetChildren()) do
        if mob:FindFirstChild("Humanoid") and mob:FindFirstChild("HumanoidRootPart") and mob.Humanoid.Health > 0 then
            local distance = (RootPart.Position - mob.HumanoidRootPart.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearestMob = mob
            end
        end
    end
    
    return nearestMob
end

local function GetNearestPlayer()
    local nearestPlayer = nil
    local shortestDistance = math.huge
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (RootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearestPlayer = player
            end
        end
    end
    
    return nearestPlayer
end

local function EquipWeapon(weaponName)
    local tool = Player.Backpack:FindFirstChild(weaponName) or Player.Character:FindFirstChild(weaponName)
    if tool and tool.Parent == Player.Backpack then
        Humanoid:EquipTool(tool)
    end
end

-- Enhanced Fast Attack Function
local function AttackFunction()
    if _G.FastAttack then
        pcall(function()
            if Player.Character:FindFirstChildOfClass("Tool") then
                local tool = Player.Character:FindFirstChildOfClass("Tool")
                if tool:FindFirstChild("Handle") then
                    -- Fast attack method 1
                    game:GetService("ReplicatedStorage").RigControllerEvent:FireServer("weaponChange", tool.Name)
                    game:GetService("ReplicatedStorage").RigControllerEvent:FireServer("hit", {
                        ["Position"] = RootPart.Position,
                        ["RayObject"] = workspace.CurrentCamera:ScreenPointToRay(math.random(1, 100), math.random(1, 100), 0),
                        ["Distance"] = 3000,
                        ["Cframe"] = RootPart.CFrame
                    }, 4, "")
                end
            end
        end)
        
        -- Alternative fast attack method
        pcall(function()
            local CombatFramework = debug.getupvalues(require(Player.PlayerScripts.CombatFramework))
            local CmrFwLib = debug.getupvalues(CombatFramework[2])
            local RigEven = debug.getupvalues(CmrFwLib[1])
            local wea = debug.getupvalues(RigEven[1])
            local delay = wea[2]
            wea[2] = 0
            wea[1][delay] = 0
        end)
    end
end

-- Bring Mobs Function
local function BringMobs()
    if _G.BringMobs then
        for _, mob in pairs(Workspace.Enemies:GetChildren()) do
            if mob:FindFirstChild("Humanoid") and mob:FindFirstChild("HumanoidRootPart") and mob.Humanoid.Health > 0 then
                local distance = (RootPart.Position - mob.HumanoidRootPart.Position).Magnitude
                if distance <= 400 then
                    mob.HumanoidRootPart.CFrame = RootPart.CFrame * CFrame.new(0, 0, -3)
                    mob.HumanoidRootPart.CanCollide = false
                    mob.Humanoid.WalkSpeed = 0
                    mob.Humanoid.JumpPower = 0
                    if mob:FindFirstChild("Body") then
                        for _, part in pairs(mob.Body:GetChildren()) do
                            if part:IsA("Part") then
                                part.CanCollide = false
                            end
                        end
                    end
                end
            end
        end
    end
end

-- tabs 
local MainTab = Window:AddTab({Title = "Main", Icon = "home"})
local AutoFarmTab = Window:AddTab({Title = "Auto Farm", Icon = "zap"})
local RaidTab = Window:AddTab({Title = "Raid", Icon = "shield"})
local V4Tab = Window:AddTab({Title = "V4 Awakening", Icon = "star"})
local PvPTab = Window:AddTab({Title = "PvP", Icon = "sword"})
local TeleportTab = Window:AddTab({Title = "Teleport", Icon = "map-pin"})
local SeaTab = Window:AddTab({Title = "Sea", Icon = "anchor"})
local SettingsTab = Window:AddTab({Title = "Settings", Icon = "settings"})

-- Main Tab
local WeaponSection = MainTab:AddSection("Weapon Selection")

local WeaponDropdown = MainTab:AddDropdown("WeaponDropdown", {
    Title = "Select Weapon",
    Values = {"Melee", "Sword", "Gun", "Fruit"},
    Multi = false,
    Default = 1,
})

WeaponDropdown:OnChanged(function(Value)
    _G.SelectedWeapon = Value
end)

local CombatSection = MainTab:AddSection("Combat")

local FastAttackToggle = MainTab:AddToggle("FastAttack", {
    Title = "Fast Attack",
    Default = false
})

FastAttackToggle:OnChanged(function(Value)
    _G.FastAttack = Value
end)

local BringMobsToggle = MainTab:AddToggle("BringMobs", {
    Title = "Bring Mobs",
    Default = false
})

BringMobsToggle:OnChanged(function(Value)
    _G.BringMobs = Value
end)

-- Sea-based Quests
local QuestSection = MainTab:AddSection("Sea Quests")

local currentSea = GetCurrentSea()

if currentSea == 1 then
    local AutoSaberToggle = MainTab:AddToggle("AutoSaber", {
        Title = "Auto Saber Quest",
        Default = false
    })
    
    AutoSaberToggle:OnChanged(function(Value)
        _G.AutoSaber = Value
    end)
    
    local AutoSecondSeaToggle = MainTab:AddToggle("AutoSecondSea", {
        Title = "Auto Second Sea Quest",
        Default = false
    })
    
    AutoSecondSeaToggle:OnChanged(function(Value)
        _G.AutoSecondSea = Value
    end)

elseif currentSea == 2 then
    local AutoRaceV2Toggle = MainTab:AddToggle("AutoRaceV2", {
        Title = "Auto Race V2",
        Default = false
    })
    
    AutoRaceV2Toggle:OnChanged(function(Value)
        _G.AutoRaceV2 = Value
    end)
    
    local AutoRaceV3Toggle = MainTab:AddToggle("AutoRaceV3", {
        Title = "Auto Race V3",
        Default = false
    })
    
    AutoRaceV3Toggle:OnChanged(function(Value)
        _G.AutoRaceV3 = Value
    end)
    
    local AutoThirdSeaToggle = MainTab:AddToggle("AutoThirdSea", {
        Title = "Auto Third Sea Quest",
        Default = false
    })
    
    AutoThirdSeaToggle:OnChanged(function(Value)
        _G.AutoThirdSea = Value
    end)

elseif currentSea == 3 then
    local AutoCDKToggle = MainTab:AddToggle("AutoCDK", {
        Title = "Auto CDK",
        Default = false
    })
    
    AutoCDKToggle:OnChanged(function(Value)
        _G.AutoCDK = Value
    end)
    
    local AutoYamaToggle = MainTab:AddToggle("AutoYama", {
        Title = "Auto Yama",
        Default = false
    })
    
    AutoYamaToggle:OnChanged(function(Value)
        _G.AutoYama = Value
    end)
    
    local AutoTushitaToggle = MainTab:AddToggle("AutoTushita", {
        Title = "Auto Tushita",
        Default = false
    })
    
    AutoTushitaToggle:OnChanged(function(Value)
        _G.AutoTushita = Value
    end)
end

-- Player Stats Section
local StatsSection = MainTab:AddSection("Player Stats")

local StatsLabel = MainTab:AddParagraph({
    Title = "Player Information",
    Content = string.format(
        "Level: %d\nMoney: %d\nFragments: %d\nRace: %s\nBounty: %d",
        GetPlayerLevel(),
        GetPlayerMoney(),
        GetPlayerFragments(),
        GetPlayerRace(),
        GetPlayerBounty()
    )
})

-- Auto Farm Tab
local LevelFarmSection = AutoFarmTab:AddSection("Level Farming")

local AutoFarmToggle = AutoFarmTab:AddToggle("AutoFarm", {
    Title = "Auto Farm Level (Max: 2650)",
    Default = false
})

AutoFarmToggle:OnChanged(function(Value)
    _G.AutoFarm = Value
end)

local AutoNearestMobsToggle = AutoFarmTab:AddToggle("AutoNearestMobs", {
    Title = "Auto Farm Nearest Mobs",
    Default = false
})

AutoNearestMobsToggle:OnChanged(function(Value)
    _G.AutoNearestMobs = Value
end)

local AutoBonesToggle = AutoFarmTab:AddToggle("AutoBones", {
    Title = "Auto Farm Bones",
    Default = false
})

AutoBonesToggle:OnChanged(function(Value)
    _G.AutoBones = Value
end)

-- Boss Section
local BossSection = AutoFarmTab:AddSection("Boss Farming")

local AutoAllBossToggle = AutoFarmTab:AddToggle("AutoAllBoss", {
    Title = "Auto Farm All Bosses",
    Default = false
})

AutoAllBossToggle:OnChanged(function(Value)
    _G.AutoAllBoss = Value
end)

local BossDropdown = AutoFarmTab:AddDropdown("BossDropdown", {
    Title = "Select Boss to Farm",
    Values = {"Gorilla King", "Bobby", "Yeti", "Mob Leader", "Vice Admiral", "Warden", "Chief Warden", "Swan", "Magma Admiral", "Fishman Lord", "Wysper", "Thunder God", "Cyborg", "Ice Admiral", "Greybeard"},
    Multi = false,
    Default = 1,
})

BossDropdown:OnChanged(function(Value)
    _G.SelectedBoss = Value
end)

local AutoSelectedBossToggle = AutoFarmTab:AddToggle("AutoSelectedBoss", {
    Title = "Auto Farm Selected Boss",
    Default = false
})

AutoSelectedBossToggle:OnChanged(function(Value)
    _G.AutoSelectedBoss = Value
end)

-- Special Bosses
local SpecialBossSection = AutoFarmTab:AddSection("Special Bosses")

local AutoRipIndraToggle = AutoFarmTab:AddToggle("AutoRipIndra", {
    Title = "Auto Rip Indra",
    Default = false
})

AutoRipIndraToggle:OnChanged(function(Value)
    _G.AutoRipIndra = Value
end)

local AutoDoughKingToggle = AutoFarmTab:AddToggle("AutoDoughKing", {
    Title = "Auto Dough King",
    Default = false
})

AutoDoughKingToggle:OnChanged(function(Value)
    _G.AutoDoughKing = Value
end)

local AutoDoughPrinceToggle = AutoFarmTab:AddToggle("AutoDoughPrince", {
    Title = "Auto Dough Prince",
    Default = false
})

AutoDoughPrinceToggle:OnChanged(function(Value)
    _G.AutoDoughPrince = Value
end)

-- Raid Tab
local RaidSection = RaidTab:AddSection("Raid Controls")

local BuyChipButton = RaidTab:AddButton({
    Title = "Buy Chip",
    Description = "Purchase raid chip",
    Callback = function()
        -- Buy chip logic
        local args = {
            [1] = "RaidsNpc",
            [2] = "Select",
            [3] = "Flame"
        }
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(args))
    end
})

local StartRaidButton = RaidTab:AddButton({
    Title = "Start Raid",
    Description = "Start the raid",
    Callback = function()
        -- Start raid logic
        local args = {
            [1] = "RaidsNpc",
            [2] = "StartRaid",
            [3] = "Flame"
        }
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(unpack(args))
    end
})

local SoloRaidToggle = RaidTab:AddToggle("SoloRaid", {
    Title = "Solo Raid (Silent Aim)",
    Default = false
})

SoloRaidToggle:OnChanged(function(Value)
    _G.SoloRaid = Value
end)

-- PvP Tab
local PvPSection = PvPTab:AddSection("Player Targeting")

local AimNearestPlayerToggle = PvPTab:AddToggle("AimNearestPlayer", {
    Title = "Aim Nearest Player",
    Default = false
})

AimNearestPlayerToggle:OnChanged(function(Value)
    _G.AimNearestPlayer = Value
end)

local SpectateToggle = PvPTab:AddToggle("Spectate", {
    Title = "Spectate Player",
    Default = false
})

SpectateToggle:OnChanged(function(Value)
    _G.SpectatePlayer = Value
    if Value then
        local nearestPlayer = GetNearestPlayer()
        if nearestPlayer then
            Workspace.CurrentCamera.CameraSubject = nearestPlayer.Character.Humanoid
        end
    else
        Workspace.CurrentCamera.CameraSubject = Player.Character.Humanoid
    end
end)

-- Combat Modes
local CombatSection = PvPTab:AddSection("Combat Modes")

local AimMeleeToggle = PvPTab:AddToggle("AimMelee", {
    Title = "Aim Melee Attack",
    Default = false
})

local AimSwordToggle = PvPTab:AddToggle("AimSword", {
    Title = "Aim Sword Attack",
    Default = false
})

local AimGunToggle = PvPTab:AddToggle("AimGun", {
    Title = "Aim Gun Attack",
    Default = false
})

local AimFruitToggle = PvPTab:AddToggle("AimFruit", {
    Title = "Aim Fruit Attack",
    Default = false
})

-- Skills Section
local SkillsSection = PvPTab:AddSection("Skills")

local SkillZToggle = PvPTab:AddToggle("SkillZ", {
    Title = "Skill Z",
    Default = false
})

SkillZToggle:OnChanged(function(Value)
    _G.SkillZ = Value
end)

local SkillXToggle = PvPTab:AddToggle("SkillX", {
    Title = "Skill X",
    Default = false
})

SkillXToggle:OnChanged(function(Value)
    _G.SkillX = Value
end)

local SkillCToggle = PvPTab:AddToggle("SkillC", {
    Title = "Skill C",
    Default = false
})

SkillCToggle:OnChanged(function(Value)
    _G.SkillC = Value
end)

local SkillVToggle = PvPTab:AddToggle("SkillV", {
    Title = "Skill V",
    Default = false
})

SkillVToggle:OnChanged(function(Value)
    _G.SkillV = Value
end)

local SkillFToggle = PvPTab:AddToggle("SkillF", {
    Title = "Skill F",
    Default = false
})

SkillFToggle:OnChanged(function(Value)
    _G.SkillF = Value
end)

-- Teleport Tab
local TeleportSection = TeleportTab:AddSection("Teleport Locations")

-- Sea-specific teleport locations
local teleportLocations = {}

if currentSea == 1 then
    teleportLocations = {
        "Spawn", "Bandit Camp", "Jungle", "Pirate Village", "Desert", "Frozen Village",
        "Marine Fortress", "Sky Island", "Prison", "Colosseum", "Magma Village",
        "Under Water City", "Fountain City", "Shells Town"
    }
elseif currentSea == 2 then
    teleportLocations = {
        "Kingdom of Rose", "Cafe", "Mansion", "Graveyard", "Snow Mountain",
        "Hot and Cold", "Cursed Ship", "Ice Castle", "Forgotten Island",
        "Desert Kingdom", "Marine Fortress"
    }
elseif currentSea == 3 then
    teleportLocations = {
        "Port Town", "Hydra Island", "Great Tree", "Castle on the Sea",
        "Floating Turtle", "Haunted Castle", "Ice Cream Island", "Peanut Island",
        "Cocoa Island", "Candy Island", "Cake Island", "Sea of Treats"
    }
end

local TeleportDropdown = TeleportTab:AddDropdown("TeleportDropdown", {
    Title = "Select Location",
    Values = teleportLocations,
    Multi = false,
    Default = 1,
})

local TeleportButton = TeleportTab:AddButton({
    Title = "Teleport",
    Description = "Teleport to selected location",
    Callback = function()
        local selectedLocation = TeleportDropdown.Value
        -- Add teleport logic here based on selected location
    end
})

-- Sea Tab
local SeaEventsSection = SeaTab:AddSection("Sea Events")

local AutoKitsuneToggle = SeaTab:AddToggle("AutoKitsune", {
    Title = "Auto Kitsune Island",
    Default = false
})

AutoKitsuneToggle:OnChanged(function(Value)
    _G.AutoKitsuneIsland = Value
end)

local AutoAzureToggle = SeaTab:AddToggle("AutoAzure", {
    Title = "Auto Azure Ember",
    Default = false
})

AutoAzureToggle:OnChanged(function(Value)
    _G.AutoAzure = Value
end)

-- Settings Tab
local InfoSection = SettingsTab:AddSection("Script Information")

local ScriptInfo = SettingsTab:AddParagraph({
    Title = "Script Creator",
    Content = "THIS SCRIPT IS CREATED BY MOHA"
})

local DiscordSection = SettingsTab:AddSection("Discord")

local DiscordButton = SettingsTab:AddButton({
    Title = "Copy Discord Server Link",
    Description = "Join our Discord community",
    Callback = function()
        setclipboard("https://discord.gg/yourdiscordlink")
        Fluent:Notify({
            Title = "Discord Link Copied!",
            Content = "Discord server link has been copied to clipboard",
            Duration = 3
        })
    end
})

-- Settings Section
local SettingsSection = SettingsTab:AddSection("Settings")

local AutoSaveToggle = SettingsTab:AddToggle("AutoSave", {
    Title = "Auto Save Settings",
    Default = true
})

local LowGraphicsToggle = SettingsTab:AddToggle("LowGraphics", {
    Title = "Low Graphics Mode",
    Default = false
})

-- Enhanced Auto Farm with Speed Optimization
local function AutoFarmLoop()
    while wait(0.1) do -- Faster loop for better performance
        pcall(function()
            if _G.AutoFarm and GetPlayerLevel() < 2650 then
                local nearestMob = GetNearestMob()
                if nearestMob and nearestMob:FindFirstChild("HumanoidRootPart") and nearestMob:FindFirstChild("Humanoid") then
                    if nearestMob.Humanoid.Health > 0 then
                        -- Equip weapon based on selection
                        EquipWeapon(_G.SelectedWeapon)
                        
                        -- Fast teleport if mob is far
                        local distance = (RootPart.Position - nearestMob.HumanoidRootPart.Position).Magnitude
                        if distance > 20 then
                            RootPart.CFrame = nearestMob.HumanoidRootPart.CFrame * CFrame.new(0, 0, -5)
                        end
                        
                        -- Attack the mob
                        AttackFunction()
                        
                        -- Bring other mobs for faster farming
                        if _G.BringMobs then
                            BringMobs()
                        end
                    end
                end
            end
        end)
    end
end

-- Skills Handler
local function SkillsLoop()
    while wait(0.5) do
        pcall(function()
            if _G.SkillZ then
                VirtualInputManager:SendKeyEvent(true, "Z", false, game)
                wait(0.1)
                VirtualInputManager:SendKeyEvent(false, "Z", false, game)
            end
            
            if _G.SkillX then
                VirtualInputManager:SendKeyEvent(true, "X", false, game)
                wait(0.1)
                VirtualInputManager:SendKeyEvent(false, "X", false, game)
            end
            
            if _G.SkillC then
                VirtualInputManager:SendKeyEvent(true, "C", false, game)
                wait(0.1)
                VirtualInputManager:SendKeyEvent(false, "C", false, game)
            end
            
            if _G.SkillV then
                VirtualInputManager:SendKeyEvent(true, "V", false, game)
                wait(0.1)
                VirtualInputManager:SendKeyEvent(false, "V", false, game)
            end
            
            if _G.SkillF then
                VirtualInputManager:SendKeyEvent(true, "F", false, game)
                wait(0.1)
                VirtualInputManager:SendKeyEvent(false, "F", false, game)
            end
        end)
    end
end

-- Main Game Loop
spawn(function()
    while wait(1) do -- Slower loop for UI updates
        pcall(function()
            -- Update player stats
            if StatsLabel then
                StatsLabel:SetDesc(string.format(
                    "Level: %d\nMoney: %d\nFragments: %d\nRace: %s\nBounty: %d",
                    GetPlayerLevel(),
                    GetPlayerMoney(),
                    GetPlayerFragments(),
                    GetPlayerRace(),
                    GetPlayerBounty()
                ))
            end
        end)
    end
end)

-- Fast Attack Loop
spawn(function()
    while wait() do
        pcall(function()
            if _G.FastAttack then
                AttackFunction()
            end
        end)
    end
end)

-- Auto Farm Loop
spawn(AutoFarmLoop)

-- Skills Loop
spawn(SkillsLoop)

-- Additional Features Loop
spawn(function()
    while wait(0.2) do
        pcall(function()
            -- Auto Nearest Mobs
            if _G.AutoNearestMobs then
                local nearestMob = GetNearestMob()
                if nearestMob then
                    local distance = (RootPart.Position - nearestMob.HumanoidRootPart.Position).Magnitude
                    if distance > 15 then
                        RootPart.CFrame = nearestMob.HumanoidRootPart.CFrame * CFrame.new(0, 0, -3)
                    end
                    AttackFunction()
                end
            end
            
            -- Solo Raid with improved deletion
            if _G.SoloRaid then
                for _, mob in pairs(Workspace.Enemies:GetChildren()) do
                    if mob:FindFirstChild("Humanoid") and mob:FindFirstChild("HumanoidRootPart") and mob.Humanoid.Health > 0 then
                        local distance = (RootPart.Position - mob.HumanoidRootPart.Position).Magnitude
                        if distance <= 1000 then -- Only delete nearby mobs
                            mob.Humanoid.Health = 0
                            wait(0.1)
                            if mob.Parent then
                                mob:Destroy()
                            end
                        end
                    end
                end
            end
            
            -- PvP Aim
            if _G.AimNearestPlayer then
                local nearestPlayer = GetNearestPlayer()
                if nearestPlayer and nearestPlayer.Character and nearestPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    local targetPosition = nearestPlayer.Character.HumanoidRootPart.Position
                    Workspace.CurrentCamera.CFrame = CFrame.lookAt(Workspace.CurrentCamera.CFrame.Position, targetPosition)
                end
            end
            
            -- Bring Mobs
            if _G.BringMobs then
                BringMobs()
            end
        end)
    end
end)

-- Character Respawn Handler
Player.CharacterAdded:Connect(function(newCharacter)
    Character = newCharacter
    Humanoid = Character:WaitForChild("Humanoid")
    RootPart = Character:WaitForChild("HumanoidRootPart")
end)
