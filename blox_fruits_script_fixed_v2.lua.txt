local Show_Button = true
local Button_Icon = "rbxassetid://135671141026630"
local Button_Transparency = 0.1

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local VirtualUser = game:GetService("VirtualUser")
local UserInputService = game:GetService("UserInputService")

-- Player Data
local Player = Players.LocalPlayer
local PlayerData = Player.Data
local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Variables
local SelectedWeapon = ""
local FastAttackEnabled = false
local AutoFarmEnabled = false
local FarmBossEnabled = false
local ESPFruitEnabled = false
local WeaponList = {}
local QuestData = nil
local CurrentTarget = nil

-- UI creation exactly as provided
local ScreenGui = Instance.new("ScreenGui")
local ImageButton = Instance.new("ImageButton")
local UICorner = Instance.new("UICorner")
local UIStroke = Instance.new("UIStroke")
local UIGradient = Instance.new("UIGradient")
local UIScale = Instance.new("UIScale")
ScreenGui.Name = "SpaceHubButton"
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ImageButton.Parent = ScreenGui
ImageButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ImageButton.BackgroundTransparency = Button_Transparency
ImageButton.BorderSizePixel = 0
ImageButton.Position = UDim2.new(0.05, 0, 0.1, 0)
ImageButton.Size = UDim2.new(0, 70, 0, 70)
ImageButton.Image = Button_Icon
ImageButton.Draggable = true
ImageButton.ImageTransparency = 0
UICorner.CornerRadius = UDim.new(0, 20)
UICorner.Parent = ImageButton
UIStroke.Parent = ImageButton
UIStroke.Color = Color3.fromRGB(0, 150, 255)
UIStroke.Thickness = 4
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
UIGradient.Parent = ImageButton
UIGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(135, 206, 250)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(70, 130, 180))
}
UIGradient.Rotation = 45

UIScale.Parent = ImageButton
UIScale.Scale = 1

-- Animation function exactly as provided
local function animateButton()
    local tween1 = game:GetService("TweenService"):Create(
        UIScale,
        TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
        {Scale = 0.8}
    )
    tween1:Play()
    tween1.Completed:Connect(function()
        local tween2 = game:GetService("TweenService"):Create(
            UIScale,
            TweenInfo.new(0.1, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
            {Scale = 1.1}
        )
        tween2:Play()
        tween2.Completed:Connect(function()
            local tween3 = game:GetService("TweenService"):Create(
                UIScale,
                TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Scale = 1}
            )
            tween3:Play()
        end)
    end)
end

-- Core Functions
local function GetPlayerLevel()
    return PlayerData.Level.Value or 1
end

local function GetPlayerMoney()
    return PlayerData.Beli.Value or 0
end

local function GetPlayerRace()
    return PlayerData.Race.Value or "Human"
end

local function GetPlayerBounty()
    return PlayerData.Bounty.Value or 0
end

local function GetCurrentSea()
    return "First Sea"
end

local function GetPlayerWeapons()
    local weapons = {}
    local backpack = Player.Backpack
    local character = Player.Character
    
    for _, item in pairs(backpack:GetChildren()) do
        if item:IsA("Tool") then
            table.insert(weapons, item.Name)
        end
    end
    
    if character then
        for _, item in pairs(character:GetChildren()) do
            if item:IsA("Tool") then
                table.insert(weapons, item.Name)
            end
        end
    end
    
    return weapons
end

local function EquipWeapon(weaponName)
    local tool = Player.Backpack:FindFirstChild(weaponName)
    if tool and Player.Character and Player.Character:FindFirstChild("Humanoid") then
        Player.Character.Humanoid:EquipTool(tool)
        SelectedWeapon = weaponName
    end
end

local function AttackFunction()
    if Player.Character and Player.Character:FindFirstChild(SelectedWeapon) then
        local tool = Player.Character:FindFirstChild(SelectedWeapon)
        if tool and tool:FindFirstChild("LocalScript") then
            require(tool.LocalScript).Hit()
        end
    end
end

local function FindNearestFruit()
    local nearestFruit = nil
    local shortestDistance = math.huge
    
    for _, obj in pairs(Workspace:GetChildren()) do
        if string.find(obj.Name, "Fruit") and obj:FindFirstChild("Handle") then
            local distance = (RootPart.Position - obj.Handle.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearestFruit = obj
            end
        end
    end
    
    return nearestFruit
end

local function BringFruit()
    local fruit = FindNearestFruit()
    if fruit and fruit:FindFirstChild("Handle") then
        fruit.Handle.CFrame = RootPart.CFrame + Vector3.new(0, 5, 0)
    end
end

local function StoreFruit()
    local args = {
        [1] = "StoreFruit",
        [2] = Player.Character:FindFirstChildOfClass("Tool")
    }
    ReplicatedStorage.Remotes.CommF_:InvokeServer(unpack(args))
end

local function CreateFruitESP()
    for _, obj in pairs(Workspace:GetChildren()) do
        if string.find(obj.Name, "Fruit") and obj:FindFirstChild("Handle") and not obj.Handle:FindFirstChild("ESP") then
            local billboard = Instance.new("BillboardGui")
            billboard.Name = "ESP"
            billboard.Parent = obj.Handle
            billboard.Size = UDim2.new(0, 100, 0, 50)
            billboard.StudsOffset = Vector3.new(0, 3, 0)
            billboard.AlwaysOnTop = true
            
            local textLabel = Instance.new("TextLabel")
            textLabel.Parent = billboard
            textLabel.Size = UDim2.new(1, 0, 1, 0)
            textLabel.BackgroundTransparency = 1
            textLabel.Text = obj.Name
            textLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
            textLabel.TextStrokeTransparency = 0
            textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
            textLabel.Font = Enum.Font.GothamBold
            textLabel.TextScaled = true
        end
    end
end

local function GetQuest()
    local level = GetPlayerLevel()
    local questGiver = nil
    local questName = ""
    local enemyName = ""
    
    if level >= 1 and level <= 9 then
        questGiver = Workspace.Map.Jungle.QuestGiver
        questName = "BanditQuest1"
        enemyName = "Bandit"
    elseif level >= 10 and level <= 14 then
        questGiver = Workspace.Map.Jungle.QuestGiver
        questName = "BanditQuest2"
        enemyName = "Monkey"
    elseif level >= 15 and level <= 29 then
        questGiver = Workspace.Map.Pirate.QuestGiver
        questName = "PirateQuest1"
        enemyName = "Pirate"
    elseif level >= 30 and level <= 39 then
        questGiver = Workspace.Map.Pirate.QuestGiver
        questName = "PirateQuest2"
        enemyName = "Brute"
    elseif level >= 40 and level <= 59 then
        questGiver = Workspace.Map.Desert.QuestGiver
        questName = "DesertQuest"
        enemyName = "Desert Bandit"
    elseif level >= 60 and level <= 74 then
        questGiver = Workspace.Map.Jungle.QuestGiver2
        questName = "JungleQuest"
        enemyName = "Gorilla King"
    elseif level >= 75 and level <= 89 then
        questGiver = Workspace.Map.Prison.QuestGiver
        questName = "PrisonerQuest"
        enemyName = "Prisoner"
    elseif level >= 90 and level <= 99 then
        questGiver = Workspace.Map.Colosseum.QuestGiver
        questName = "ColosseumQuest"
        enemyName = "Toga Warrior"
    elseif level >= 100 and level <= 119 then
        questGiver = Workspace.Map.Magma.QuestGiver
        questName = "MagmaQuest"
        enemyName = "Military Soldier"
    elseif level >= 120 and level <= 149 then
        questGiver = Workspace.Map.Magma.QuestGiver2
        questName = "MagmaQuest2"
        enemyName = "Military Spy"
    end
    
    return {
        giver = questGiver,
        name = questName,
        enemy = enemyName
    }
end

local function StartQuest()
    local quest = GetQuest()
    if quest.giver then
        local args = {
            [1] = "StartQuest",
            [2] = quest.name,
            [3] = 1
        }
        ReplicatedStorage.Remotes.CommF_:InvokeServer(unpack(args))
        QuestData = quest
    end
end

local function FindNearestEnemy()
    local quest = QuestData or GetQuest()
    local nearestEnemy = nil
    local shortestDistance = math.huge
    
    for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
        if enemy.Name == quest.enemy and enemy:FindFirstChild("HumanoidRootPart") and enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
            local distance = (RootPart.Position - enemy.HumanoidRootPart.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearestEnemy = enemy
            end
        end
    end
    
    return nearestEnemy
end

local function FindNearestBoss()
    local nearestBoss = nil
    local shortestDistance = math.huge
    
    for _, boss in pairs(Workspace.Enemies:GetChildren()) do
        if boss:FindFirstChild("HumanoidRootPart") and boss:FindFirstChild("Humanoid") and boss.Humanoid.Health > 0 then
            if string.find(boss.Name, "Boss") or boss.Humanoid.MaxHealth > 5000 then
                local distance = (RootPart.Position - boss.HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearestBoss = boss
                end
            end
        end
    end
    
    return nearestBoss
end

local function TeleportToTarget(target)
    if target and target:FindFirstChild("HumanoidRootPart") and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        Player.Character.HumanoidRootPart.CFrame = target.HumanoidRootPart.CFrame * CFrame.new(0, 0, 5)
    end
end

local function KillAllBosses()
    for _, boss in pairs(Workspace.Enemies:GetChildren()) do
        if boss:FindFirstChild("Humanoid") and (string.find(boss.Name, "Boss") or boss.Humanoid.MaxHealth > 5000) then
            boss.Humanoid.Health = 0
        end
    end
end

local function BossDownDrop()
    local boss = FindNearestBoss()
    if boss then
        boss.Humanoid.Health = 0
    end
end

-- Load exactly as provided in the requirement  
wait(3)

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "ENCHANTED HUB | BLOX FRUIT  sea 1",
    SubTitle = "Created by AABIS & moha  ",
    TabWidth = 125,
    Size = UDim2.fromOffset(600, 500),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- tabs exactly as provided
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" }),
    AutoFarm = Window:AddTab({ Title = "Auto Farm", Icon = "fan" }),
}

-- Main Tab Implementation
WeaponList = GetPlayerWeapons()

local WeaponDropdown = Tabs.Main:AddDropdown("WeaponSelect", {
    Title = "Choose Weapon",
    Values = WeaponList,
    Multi = false,
    Default = WeaponList[1] or "",
    Callback = function(Value)
        SelectedWeapon = Value
        EquipWeapon(Value)
    end
})

Tabs.Main:AddToggle("FastAttack", {
    Title = "Fast Attack",
    Default = false,
    Callback = function(Value)
        FastAttackEnabled = Value
    end
})

Tabs.Main:AddSection("Fruits")

Tabs.Main:AddButton({
    Title = "Bring Fruit",
    Description = "Teleport available fruits to player",
    Callback = function()
        BringFruit()
    end
})

Tabs.Main:AddButton({
    Title = "Store Fruit",
    Description = "Store fruit in inventory",
    Callback = function()
        StoreFruit()
    end
})

Tabs.Main:AddToggle("ESPFruit", {
    Title = "ESP Fruit",
    Default = false,
    Callback = function(Value)
        ESPFruitEnabled = Value
        if not Value then
            for _, obj in pairs(Workspace:GetChildren()) do
                if string.find(obj.Name, "Fruit") and obj:FindFirstChild("Handle") and obj.Handle:FindFirstChild("ESP") then
                    obj.Handle.ESP:Destroy()
                end
            end
        end
    end
})

Tabs.Main:AddSection("STATS")

local StatsFrame = Tabs.Main:AddParagraph({
    Title = "Player Statistics",
    Content = "Loading stats..."
})

-- Auto Farm Tab Implementation
Tabs.AutoFarm:AddToggle("AutoFarm", {
    Title = "Auto Farm",
    Default = false,
    Callback = function(Value)
        AutoFarmEnabled = Value
        if Value then
            StartQuest()
        end
    end
})

Tabs.AutoFarm:AddButton({
    Title = "Boss DownDrop",
    Description = "Instantly kill boss and collect drops",
    Callback = function()
        BossDownDrop()
    end
})

Tabs.AutoFarm:AddToggle("FarmBoss", {
    Title = "Farm Boss",
    Default = false,
    Callback = function(Value)
        FarmBossEnabled = Value
    end
})

Tabs.AutoFarm:AddButton({
    Title = "Kill All Boss",
    Description = "Eliminate all bosses",
    Callback = function()
        KillAllBosses()
    end
})

-- Button click exactly as provided
local isHidden = false
ImageButton.MouseButton1Click:Connect(function()
    animateButton()
    wait(0.2)
    if isHidden then
        for _, gui in pairs(game.CoreGui:GetChildren()) do
            if gui.Name == "ScreenGui" and gui:FindFirstChild("Frame") then
                gui.Enabled = true
            end
        end
        if Window and Window.Root then
            Window.Root.Visible = true
        end
        isHidden = false
    else
        for _, gui in pairs(game.CoreGui:GetChildren()) do
            if gui.Name == "ScreenGui" and gui:FindFirstChild("Frame") then
                gui.Enabled = false
            end
        end
        if Window and Window.Root then
            Window.Root.Visible = false
        end
        isHidden = true
    end
end)

-- Main execution loops
RunService.Heartbeat:Connect(function()
    -- Update stats
    StatsFrame:SetDesc(string.format(
        "Level: %d\nMoney: %d\nRace: %s\nBounty: %d\nCurrent Sea: %s",
        GetPlayerLevel(),
        GetPlayerMoney(),
        GetPlayerRace(),
        GetPlayerBounty(),
        GetCurrentSea()
    ))
    
    -- Update weapon list
    local newWeapons = GetPlayerWeapons()
    if #newWeapons ~= #WeaponList then
        WeaponList = newWeapons
        WeaponDropdown:SetValues(WeaponList)
    end
    
    -- Fast Attack
    if FastAttackEnabled then
        AttackFunction()
    end
    
    -- Auto Farm
    if AutoFarmEnabled then
        local enemy = FindNearestEnemy()
        if enemy then
            CurrentTarget = enemy
            TeleportToTarget(enemy)
            AttackFunction()
        else
            StartQuest()
        end
    end
    
    -- Farm Boss
    if FarmBossEnabled then
        local boss = FindNearestBoss()
        if boss then
            CurrentTarget = boss
            TeleportToTarget(boss)
            AttackFunction()
        end
    end
    
    -- ESP Fruit
    if ESPFruitEnabled then
        CreateFruitESP()
    end
end)

-- Character respawn handling
Player.CharacterAdded:Connect(function(character)
    Character = character
    Humanoid = character:WaitForChild("Humanoid")
    RootPart = character:WaitForChild("HumanoidRootPart")
end)
